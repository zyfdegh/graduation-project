function loginService(a,b){return{checkFunc:function(a,b){var c="",d=!0;return _.isEmpty(b)&&(c=a+" is required",d=!1),{status:d,message:c}},checkConfirmPwd:function(a,b){var c="",d=!0;return _.isEmpty(b)&&(c="confirm password is required",d=!1),{status:d,message:c}},checkWithPwd:function(a,b){var c=!0;return b!=a&&(c=!1),{status:c}},checkNamespacePattern:function(a){var b=!0,c=/^[0-9a-z]+$/;return""==a||c.test(a)||(b=!1),{status:b}},doLogin:function(c){var d="/user/login",e={url:d,dataType:"json",method:"POST",data:JSON.stringify(c)},f=b.defer();return a(e).success(function(a){f.resolve(a)}).error(function(a){f.reject(a)}),f.promise},doSignUp:function(c){var d="/user/registry",e={url:d,dataType:"json",method:"POST",data:JSON.stringify(c)},f=b.defer();return a(e).success(function(a){f.resolve(a)}).error(function(a){f.reject(a)}),f.promise},doLogout:function(){var c="/logout",d={url:c,method:"GET"},e=b.defer();return a(d).success(function(a){e.resolve(a)}).error(function(a){e.reject(a)}),e.promise},reactive:function(c){var d="/user/reactive?uid="+c,e={url:d,method:"GET"},f=b.defer();return a(e).success(function(a){f.resolve(a)}).error(function(a){f.reject(a)}),f.promise}}}var login=angular.module("login",["ngRoute","ui.bootstrap","pascalprecht.translate","ngCookies"]);login.config(function(a,b){a.when("/",{templateUrl:"templates/login/signin.html",controller:"LoginController"}).when("/signup",{templateUrl:"templates/login/signup.html",controller:"SignUpController"}).when("/activeSuccess",{templateUrl:"templates/login/active_success.html",controller:"ActiveSuccessController"}).when("/activeFailed",{templateUrl:"templates/login/active_failed.html",controller:"ActiveFailedController"}).otherwise({redirectTo:"/"})}).config(["$translateProvider",function(a){var b="zh";a.useStaticFilesLoader({prefix:"/portal-ui/locales/",suffix:".json"}),a.useLocalStorage(),a.useSanitizeValueStrategy("escape"),a.preferredLanguage(b)}]).run(["$rootScope","$translate",function(a,b){a.$translate=b}]).run(["$rootScope",function(a){$(window).load(function(){a.loaded=!0})}]),login.controller("LoginController",["$scope","$modal","loginService",function(a,b,c){var d=a.$translate.storage(),e=a.$translate.storageKey(),f=d.get(e)||"zh";a.$translate.use(f),a.userInfo={email:"",password:""},a.userNameResult={status:!0,message:""},a.passwordResult={status:!0,message:""},a.doLogin=function(){return a.userNameResult=c.checkFunc("email",a.userInfo.email),a.passwordResult=c.checkFunc("password",a.userInfo.password),1!=a.userNameResult.status||1!=a.passwordResult.status?!1:void c.doLogin(a.userInfo).then(function(b){sessionStorage.username=a.userInfo.email,sessionStorage.namespace=b.data.alias,window.location="/portal-ui/index.html"},function(a){b.open({templateUrl:"templates/login/fail.html",controller:"OperateFailedCtrl",size:"sm",resolve:{model:function(){return{message:a}}}})})}}]).controller("SignUpController",["$scope","$modal","loginService",function(a,b,c){a.policy={agree:!1},a.userInfo={alias:"",email:"",password:"",confirmpassword:"",company:"",address:"",phonenumber:"",infosource:"community"},a.emailResult={status:!0,message:""},a.passwordResult={status:!0,message:""},a.confirmPwdResult={status:!0,message:""},a.confirmCoPwdResult={status:!0,message:""},a.namespaceResult={status:!0,message:""},a.namespacePatternResult={status:!0,message:""},a.register={step:"step1"},a.toggleStatus=function(){a.policy.agree=!a.policy.agree},a.doSignUp=function(){return a.namespaceResult=c.checkFunc("namespace",a.userInfo.alias),a.namespacePatternResult=c.checkNamespacePattern(a.userInfo.alias),a.emailResult=c.checkFunc("email",a.userInfo.email),a.passwordResult=c.checkFunc("password",a.userInfo.password),a.confirmPwdResult=c.checkConfirmPwd(a.userInfo.password,a.userInfo.confirmpassword),a.confirmCoPwdResult=c.checkWithPwd(a.userInfo.password,a.userInfo.confirmpassword),1!=a.namespaceResult.status||1!=a.namespacePatternResult.status||1!=a.passwordResult.status||1!=a.confirmPwdResult.status||1!=a.confirmCoPwdResult.status||1!=a.emailResult.status?!1:void c.doSignUp(a.userInfo).then(function(b){a.register.step="step2"},function(a){b.open({templateUrl:"templates/login/fail.html",controller:"OperateFailedCtrl",size:"sm",resolve:{model:function(){return{message:a}}}})})}}]).controller("OperateSuccessCtrl",["$scope","$modalInstance","model",function(a,b,c){a.message=c.message,a.close=function(a){b.close(a)}}]).controller("OperateFailedCtrl",["$scope","$modalInstance","model",function(a,b,c){a.message=c.message,a.close=function(a){b.close(a)}}]).controller("ActiveSuccessController",["$scope",function(a){}]).controller("ActiveFailedController",["$scope","$location","loginService","$modal",function(a,b,c,d){a.params=b.search(),a.reactive=function(){c.reactive(a.params.uid).then(function(a){d.open({templateUrl:"templates/login/success.html",controller:"ReactiveSuccessCtrl",size:"sm",resolve:{model:function(){return{message:"We have send an active email to you, please active your account again."}}}})},function(b){location.path="/login.html#/activeFailed?uid="+a.params.uid})}}]).controller("ReactiveSuccessCtrl",["$scope","$modalInstance","model",function(a,b,c){a.message=c.message,a.close=function(a){b.close()}}]),login.factory("loginService",["$http","$q",loginService]),login.directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}});